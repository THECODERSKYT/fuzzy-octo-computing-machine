name: Loophole TinyProxy Tunnel

on: [workflow_dispatch]

jobs:
  tunnel:
    runs-on: ubuntu-latest
    steps:
    - name: Install TinyProxy
      run: |
        sudo apt update
        sudo apt install tinyproxy curl unzip -y
        sudo sed -i 's/^Port .*/Port 8888/' /etc/tinyproxy/tinyproxy.conf
        sudo sed -i 's/^#Allow 127.0.0.1/Allow 0.0.0.0/' /etc/tinyproxy/tinyproxy.conf
        sudo systemctl start tinyproxy
    - name: Download and Start Loophole
      run: |
        curl -Lo loophole.zip https://github.com/loophole/cli/releases/latest/download/loophole-linux-amd64.zip
        unzip loophole.zip
        chmod +x loophole
        ./loophole http 8888 --region ap &
        sleep 10
    - name: Keep Alive
      run: |
        while true; do echo "‚è≥ Still Running"; sleep 300; done
